import{g as h,o as d,c as y,t as f,n as m,_ as b,j as v,w as S,b as g,k as A,r as $,l as M,m as R,F as V,p as C,q as u,a}from"./DXvi0OHx.js";import{_ as T}from"./Dnn3SQrY.js";import{B}from"./lB-aIDQI.js";import{u as x,a as j,T as E}from"./BvwcPJWv.js";const N=h({__name:"StatusBadge",props:{title:{},status:{}},setup(e){return(t,o)=>(d(),y("div",{class:m(`${t.$style[e.status]} ${t.$style.badge}`)},f(e.title),3))}}),O="_badge_jewme_1",z="_active_jewme_10",D="_completed_jewme_16",F="_draft_jewme_21",q={badge:O,active:z,completed:D,draft:F},U={$style:q},H=Object.assign(b(N,[["__cssModules",U]]),{__name:"UiStatusBadge"}),P=h({__name:"Actions",props:{id:{},isReady:{type:Boolean}},emits:["send"],setup(e,{emit:t}){const o=t,s=()=>{o("send",e.id)};return(n,c)=>{const _=T;return d(),y("div",{class:m(n.$style.actions)},[e.isReady?A("",!0):(d(),v(_,{key:0,to:`/edit?id=${e.id}`},{default:S(()=>[g(B,{title:"Редактировать",hierarchy:"tertiary",size:"small"})]),_:1},8,["to"])),e.isReady?(d(),v(B,{key:1,onClick:s,title:"Отправить",hierarchy:"primary",size:"small"})):A("",!0)],2)}}}),W="_actions_i3imw_1",G={actions:W},I={$style:G},J=Object.assign(b(P,[["__cssModules",I]]),{__name:"ApplicationsActions"}),K={active:"Активна",pending:"В ожидании",approved:"Подтверждён",rejected:"Отклонён",completed:"Завершён",cancelled:"Отменён",draft:"Черновик"};function Q(e){return K[e]||e}const X={in_progress:"В обработке",passed:"Пройдена",failed:"Не пройдена",requires_review:"Требует проверки",on_hold:"На удержании",expired:"Истекла"};function Y(e){return X[e]||e}const Z=async()=>{const e=$([]),t=$(null),{data:o,error:s}=await x("/api/table-data","$yW7hHnS9g_");return s.value&&(t.value=s.value),e.value=o.value||[],{applications:e,error:t}},L=$(0);function k(){return{storageVersion:L,bump:()=>{L.value++}}}function ee(e){const{get:t,remove:o}=j(),s=$(null),{bump:n,storageVersion:c}=k();return{readySet:M(()=>{c.value;const l=new Set;for(const r of e.value)t(`application-${r.id}`,null)&&l.add(r.id);return l}),send:async l=>{try{const r=t(`application-${l}`,null);if(!(await $fetch("/api/send",{method:"POST",body:{id:l,products:r}})).success)throw new Error("Send failed");o(`application-${l}`),n(),c.value++}catch(r){s.value=r instanceof Error?r:new Error(String(r))}},error:s}}function te(e){const{get:t}=j(),{storageVersion:o}=k(),s=M(()=>{o.value;const n=new Map;for(const c of e.value)!!t(`application-${c.id}`,null)?n.set(c.id,"draft"):n.set(c.id,c.status);return console.log(n),n});return{getStatus:n=>s.value.get(n)??"active"}}const se=h({__name:"Table",emits:["send"],async setup(e){let t,o;const{applications:s}=([t,o]=R(()=>Z()),t=await t,o(),t),{readySet:n,send:c}=ee(s),{getStatus:_}=te(s);return(p,l)=>{const r=H,w=J;return d(),v(E,null,{header:S(()=>[...l[0]||(l[0]=[a("tr",null,[a("th",null,"Номер"),a("th",null,"Статус"),a("th",null,"Результат"),a("th",null,"Дата"),a("th",null,"Действие")],-1)])]),default:S(()=>[(d(!0),y(V,null,C(u(s),i=>(d(),y("tr",{class:m(u(n).has(i.id)?p.$style.ready:"")},[a("td",null,f(i.number),1),a("td",null,[g(r,{status:u(_)(i.id),title:("getStatusLabel"in p?p.getStatusLabel:u(Q))(u(_)(i.id))},null,8,["status","title"])]),a("td",null,f(("getResultLabel"in p?p.getResultLabel:u(Y))(i.verificationResult)),1),a("td",null,f(i.createdAt),1),a("td",null,[g(w,{id:i.id,"is-ready":u(n).has(i.id),onSend:u(c)},null,8,["id","is-ready","onSend"])])],2))),256))]),_:1})}}}),ne="_ready_gvdt0_1",ae={ready:ne},oe={$style:ae},ce=Object.assign(b(se,[["__cssModules",oe]]),{__name:"ApplicationsTable"}),re=h({__name:"index",setup(e){return(t,o)=>{const s=ce;return d(),y("div",{class:m(t.$style.container)},[a("h1",{class:m(t.$style["main-header"])},"Заявки",2),a("div",{class:m(t.$style["table-container"])},[g(s)],2)],2)}}}),le="_container_1warc_1",ie={container:le,"table-container":"_table-container_1warc_8","main-header":"_main-header_1warc_12"},ue={$style:ie},ye=b(re,[["__cssModules",ue]]);export{ye as default};
