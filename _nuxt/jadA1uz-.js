import{_ as T}from"./Dnn3SQrY.js";import{_ as L,o as m,c as f,b as g,w as V,a as r,n as d,g as A,r as y,q as p,k as M,l as I,s as N,v as R,x as q,y as z,t as j,F as B,p as E,d as D,z as K,A as F,m as O,B as H}from"./DXvi0OHx.js";import{u as x,a as U,T as W}from"./BvwcPJWv.js";import{B as Z}from"./lB-aIDQI.js";const G="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M11.5983%205.75666C11.8912%206.04955%2011.8912%206.52442%2011.5983%206.81732L7.16564%2011.25H18.669C19.0832%2011.25%2019.419%2011.5858%2019.419%2012C19.419%2012.4142%2019.0832%2012.75%2018.669%2012.75H7.16564L11.5983%2017.1827C11.8912%2017.4755%2011.8912%2017.9504%2011.5983%2018.2433C11.3054%2018.5362%2010.8305%2018.5362%2010.5377%2018.2433L4.82465%2012.5303C4.684%2012.3897%204.60498%2012.1989%204.60498%2012C4.60498%2011.8011%204.684%2011.6103%204.82465%2011.4697L10.5377%205.75666C10.8305%205.46376%2011.3054%205.46376%2011.5983%205.75666Z'%20fill='%23A7A5A5'/%3e%3c/svg%3e",X="_back_rzsju_19",J={"main-header":"_main-header_rzsju_1","save-button":"_save-button_rzsju_7","container-header":"_container-header_rzsju_11",back:X},Q={};function Y(e,l){const t=T;return m(),f("header",{class:d(e.$style["container-header"])},[g(t,{to:"/"},{default:V(()=>[r("img",{class:d(e.$style.back),src:G,alt:"toggle"},null,2)]),_:1}),r("h1",{class:d(e.$style["main-header"])},"Товары",2)],2)}const ee={$style:J},te=Object.assign(L(Q,[["render",Y],["__cssModules",ee]]),{__name:"ProductsHeader"}),le=["Красный","Голубой","Зеленый","Желтый","Черный"],ne="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M4.6027%204.58679C4.82235%204.3671%205.17851%204.36706%205.3982%204.58671L9.00024%208.18808L12.6023%204.58671C12.822%204.36706%2013.1781%204.3671%2013.3978%204.58679C13.6174%204.80648%2013.6174%205.16263%2013.3977%205.38228L9.79581%208.9835L13.3977%2012.5847C13.6174%2012.8044%2013.6174%2013.1605%2013.3978%2013.3802C13.1781%2013.5999%2012.822%2013.5999%2012.6023%2013.3803L9.00024%209.77892L5.3982%2013.3803C5.17851%2013.5999%204.82235%2013.5999%204.6027%2013.3802C4.38305%2013.1605%204.38309%2012.8044%204.60278%2012.5847L8.20467%208.9835L4.60278%205.38228C4.38309%205.16263%204.38305%204.80648%204.6027%204.58679Z'%20fill='%23A7A5A5'/%3e%3c/svg%3e";function se(e){const l=s=>{let o=s.replace(/,/g,".").replace(/[^\d.]/g,"");const c=o.split(".");return c.length>2&&(o=c[0]+"."+c.slice(1).join("")),o};return{handleInput:s=>{const o=s.target.value,c=l(o);return e.value=c,c},handleKeydown:s=>{["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(s.key)||/^\d$/.test(s.key)||s.key==="."&&!e.value.includes(".")||s.preventDefault()},clear:()=>{e.value=""}}}const oe=["placeholder","value"],ae=A({__name:"Input",props:{value:{},placeholder:{},error:{type:Boolean}},emits:["update:modelValue","clear"],setup(e,{emit:l}){const t=l,n=y(e.value??""),a=y(null),s=I(()=>n.value.length>0),{handleInput:o,handleKeydown:c,clear:w}=se(n),C=_=>{const i=o(_);t("update:modelValue",i)},u=()=>{w(),t("update:modelValue",""),t("clear"),N(()=>{a.value?.focus()})};return(_,i)=>(m(),f("div",{class:d(_.$style.inputWrapper)},[r("input",{ref_key:"inputRef",ref:a,placeholder:e.placeholder,value:p(n),class:d([_.$style.input,e.error&&_.$style.inputError]),onInput:C,onKeydown:i[0]||(i[0]=(...$)=>p(c)&&p(c)(...$))},null,42,oe),p(s)?(m(),f("button",{key:0,type:"button",class:d(_.$style.clearButton),onClick:u},[...i[1]||(i[1]=[r("img",{src:ne,alt:"closeIcon"},null,-1)])],2)):M("",!0)],2))}}),re="_inputError_161k0_1",ce="_input_161k0_1",ue="_inputWrapper_161k0_20",ie="_clearButton_161k0_26",de="_clearIcon_161k0_47",pe={inputError:re,input:ce,inputWrapper:ue,clearButton:ie,clearIcon:de},_e={$style:pe},S=Object.assign(L(ae,[["__cssModules",_e]]),{__name:"UiInput"}),ve="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M3.78267%206.68975C4.00234%206.47008%204.3585%206.47008%204.57817%206.68975L9.00289%2011.1145L13.4269%206.68978C13.6465%206.47009%2014.0027%206.47006%2014.2224%206.68972C14.4421%206.90937%2014.4421%207.26552%2014.2224%207.48521L9.4007%2012.3077C9.29521%2012.4132%209.15213%2012.4725%209.00294%2012.4725C8.85375%2012.4725%208.71067%2012.4132%208.60517%2012.3077L3.78267%207.48524C3.563%207.26557%203.563%206.90942%203.78267%206.68975Z'%20fill='%23A7A5A5'/%3e%3c/svg%3e",me="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M15.4409%206.22366C15.6855%206.46716%2015.6865%206.86288%2015.443%207.10754L9.02218%2013.5591C8.90491%2013.6769%208.74553%2013.7432%208.57929%2013.7432C8.41305%2013.7432%208.25364%2013.677%208.13634%2013.5592L4.55715%209.96528C4.31357%209.7207%204.31439%209.32497%204.55897%209.08139C4.80355%208.83782%205.19928%208.83864%205.44285%209.08321L8.57904%2012.2323L14.557%206.22577C14.8005%205.98111%2015.1962%205.98017%2015.4409%206.22366Z'%20fill='%23FC8507'/%3e%3c/svg%3e";function fe(e=null){const l=y(e),t=y(!1),n=y(null),a=()=>{t.value=!t.value},s=c=>{l.value=c,t.value=!1},o=c=>{n.value?.contains(c.target)||(t.value=!1)};return R(()=>{document.addEventListener("click",o)}),q(()=>{document.removeEventListener("click",o)}),{value:l,isOpen:t,wrapperRef:n,toggleOpen:a,selectOption:s}}const ye=["value"],he={class:"selected"},ge=["onClick"],we={key:0,src:me,alt:"check"},$e=A({__name:"Select",props:{modelValue:{},options:{},placeholder:{default:"Выберите"},error:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:l}){const t=e,n=l,{value:a,isOpen:s,wrapperRef:o,toggleOpen:c,selectOption:w}=fe(t.modelValue??""),C=u=>{w(u),n("update:modelValue",u)};return z(()=>t.modelValue,u=>{a.value=u??""}),(u,_)=>(m(),f("div",{class:d(u.$style.wrapper),ref_key:"wrapperRef",ref:o},[r("div",{value:p(a),class:d([u.$style.select,e.error&&u.$style.error,p(s)&&u.$style.focus]),onFocus:_[0]||(_[0]=i=>s.value=!0),onClick:_[1]||(_[1]=(...i)=>p(c)&&p(c)(...i))},[r("span",he,j(p(a)||e.placeholder),1),r("img",{class:d([u.$style.chevronDown,p(s)?u.$style.rotate:""]),src:ve,alt:"chevron"},null,2)],42,ye),r("ul",{class:d([u.$style.options,p(s)?u.$style.show:""])},[(m(!0),f(B,null,E(e.options,i=>(m(),f("li",{key:i,class:d([u.$style.option,p(a)===i&&u.$style.selectOption]),onClick:$=>C(i)},[D(j(i)+" ",1),p(a)===i?(m(),f("img",we)):M("",!0)],10,ge))),128))],2)],2))}}),Ce="_wrapper_1jcl4_1",ke="_select_1jcl4_7",be="_focus_1jcl4_21",Le="_chevronDown_1jcl4_25",Ve="_options_1jcl4_36",Oe="_show_1jcl4_57",je="_option_1jcl4_36",Be="_selectOption_1jcl4_77",Ee="_rotate_1jcl4_81",Ae="_inputError_1jcl4_85",Se={wrapper:Ce,select:ke,focus:be,chevronDown:Le,options:Ve,show:Oe,option:je,selectOption:Be,rotate:Ee,inputError:Ae},Me={$style:Se},Ie=Object.assign(L($e,[["__cssModules",Me]]),{__name:"UiSelect"}),Re=/^\d+(\.\d+)?$/,Ue=/^\d+$/;function Pe(){const e=y({}),l=n=>{const a={};if(Ue.test(String(n.quantity))||(a.quantity=!0),Re.test(String(n.price))||(a.price=!0),Object.keys(a).length>0)return e.value={...e.value,[n.id]:a},!1;const{[n.id]:s,...o}=e.value;return e.value=o,!0};return{errors:e,validateAll:n=>{e.value={};let a=!0;for(const s of n)l(s)||(a=!1);return a},validateProduct:l}}const Te=()=>{const e=K();return I(()=>{const t=e.query.id;return t?Number(t):null})},Ne=async e=>{const l=y([]),t=y(!1),n=y(null);return{products:l,load:async()=>{if(!e.value)return;t.value=!0,n.value=null;const{data:s,error:o}=await x("/api/products",{query:{id:e.value}},"$HOS-uSUCNU");if(o.value){n.value=o.value,t.value=!1;return}l.value=s.value||[],t.value=!1},loading:t,error:n}},qe=async(e,l,t)=>{const{get:n,set:a}=U();return{load:async()=>{if(!e.value)return;const o=`application-${e.value}`,c=n(o,null);if(c){l.value=c;return}await t(),a(o,l.value),await new Promise(w=>setTimeout(w,2e3))}}},ze=async(e,l)=>{const t=F(),{set:n}=U(),a=y(null);return{save:async()=>{if(!e.value)return;a.value=null;const o=`application-${e.value}`;n(o,l.value),t.push("/")},error:a}},De=A({__name:"Table",async setup(e){let l,t;const{errors:n,validateAll:a}=Pe(),s=Te(),{products:o,load:c,loading:w}=([l,t]=O(()=>Ne(s)),l=await l,t(),l),{load:C}=([l,t]=O(()=>qe(s,o,c)),l=await l,t(),l),{save:u}=([l,t]=O(()=>ze(s,o)),l=await l,t(),l),_=y(!0);R(async()=>{await C()});const i=()=>{_.value=!0},$=(h,k)=>(console.log(n.value[h]?.[k]),n.value[h]?.[k]),P=()=>{_.value=a(o.value),_.value&&u()};return(h,k)=>(m(),f("div",{class:d(h.$style.container)},[g(Z,{onClick:P,title:"Сохранить",hierarchy:"primary",size:"small",class:d(h.$style["save-button"]),disabled:!p(_)},null,8,["class","disabled"]),g(W,null,H({header:V(()=>[k[0]||(k[0]=r("tr",null,[r("th",null,"Название"),r("th",null,"Количество"),r("th",null,"Цена"),r("th",null,"Цвет")],-1))]),_:2},[p(w)?{name:"default",fn:V(()=>[(m(),f(B,null,E(3,v=>r("tr",{key:v},[r("td",null,[r("div",{class:d(h.$style.skeletonCell)},null,2)]),r("td",null,[r("div",{class:d(h.$style.skeletonCell)},null,2)]),r("td",null,[r("div",{class:d(h.$style.skeletonCell)},null,2)]),r("td",null,[r("div",{class:d(h.$style.skeletonCell)},null,2)])])),64))]),key:"0"}:{name:"default",fn:V(()=>[(m(!0),f(B,null,E(p(o),v=>(m(),f("tr",{key:v.id},[r("td",null,j(v.name),1),r("td",null,[g(S,{placeholder:"0",value:String(v.quantity),error:$(v.id,"quantity"),"onUpdate:modelValue":b=>{v.quantity=b,i()}},null,8,["value","error","onUpdate:modelValue"])]),r("td",null,[g(S,{placeholder:"0",value:String(v.price),error:$(v.id,"price"),"onUpdate:modelValue":b=>{v.price=b,i()}},null,8,["value","error","onUpdate:modelValue"])]),r("td",null,[g(Ie,{modelValue:v.color,"onUpdate:modelValue":[b=>v.color=b,i],options:p(le),error:$(v.id,"color")},null,8,["modelValue","onUpdate:modelValue","options","error"])])]))),128))]),key:"1"}]),1024)],2))}}),Ke="_container_p0666_1",Fe="_skeletonCell_p0666_17",He="_emptyState_p0666_25",xe={container:Ke,"save-button":"_save-button_p0666_7",skeletonCell:Fe,"skeleton-loading":"_skeleton-loading_p0666_1",emptyState:He},We={$style:xe},Ze=Object.assign(L(De,[["__cssModules",We]]),{__name:"ProductsTable"}),Ge="_container_d5owo_1",Xe={container:Ge,"table-container":"_table-container_d5owo_8"},Je={};function Qe(e,l){const t=te,n=Ze;return m(),f("div",{class:d(e.$style.container)},[g(t),r("div",{class:d(e.$style["table-container"])},[g(n)],2)],2)}const Ye={$style:Xe},st=L(Je,[["render",Qe],["__cssModules",Ye]]);export{st as default};
